{% extends "base.html" %}
{% load static %}
{% load i18n %}

{% block title %}ESODA | search result{% endblock %}

{% block head %}
  <link href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">
{% endblock %}

{% block content %}

  <div class="result-page">
    <div class="container">
      <div class="row">
        <div class="col-sm-9 result-main">
          <div>

            <div class="result-warning">
              当前个人领域为"<span id="SearchDomain">{{ r.domain }}</span>"，搜索"<span id="SearchKeyWord">{{ q }}</span>"结果共<span id="CountUsage">{{ r.count }}</span>句例句，在其他<a href="#">个人领域</a>中搜索
            </div>

            <div class="panel-group" role="tablist" aria-multiselectable="true">
              <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="HeadingDict">
                  <div class="panel-title-wrapper">
                    <div class="panel-title display-inline">
                      词典
                      <span class="panel-subtitle">Dictionary</span>
                    </div>
                    <a role="button" data-toggle="collapse" href="#CollapseDict" aria-expanded="true" aria-controls="CollapseDict" onclick="$.clickChevron(event);">
                      <span class="glyphicon glyphicon-chevron-down right-float"></span>
                    </a>
                  </div>
                </div>
                <div id="CollapseDict" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="HeadingDict">
                  <div class="dictionary-container">
                    <div class="dictionary-left">
                      <div class="dictionary-hint">
                        搜索内容：英文
                      </div>
                      <p id="ResultItem">{{ dictionary.word }}</p>
                      <div class="row display-none">
                        <div class="col-sm-6 col-md-4">
                          <span class="glyphicon glyphicon-volume-up"></span>
                          <span>英</span>
                          <span id="EnglishPronounce">{{ dictionary.english }}</span>
                        </div>
                        <div class="col-sm-6 col-md-4">
                          <span class="glyphicon glyphicon-volume-up"></span>
                          <span>美</span>
                          <span id="AmericanPronounce">{{ dictionary.american }}</span>
                        </div>
                      </div>
                      <div class="dictionary-edit">
                        <a href="">编辑&nbsp;<span class="glyphicon glyphicon-pencil"></span></a>
                      </div>
                    </div>
                    <div class="dictionary-middle">
                      <div class="dictionary-middle-line"></div>
                      <a href=""><span class="glyphicon glyphicon-refresh"></span></a>
                      <div class="dictionary-middle-line"></div>
                    </div>
                    <div class="dictionary-right">
                      <div class="dictionary-hint">中文翻译</div>
                      <div id="WordExplanation">
                        {% for explanation in dictionary.explanationList %}
                        <p>{{ explanation }}</p>
                        {% endfor %}
                      </div>
                    </div>
                  </div>
                </div>
              </div> <!-- dictionary panel -->

              <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="HeadingUsage">
                  <div class="panel-title-wrapper">
                    <div class="panel-title display-inline">
                      用法
                      <span class="panel-subtitle">Usage</span>
                    </div>
                    <a role="button" data-toggle="collapse" href="#CollapseUsage" aria-expanded="true" aria-controls="CollapseUsage" onclick="$.clickChevron(event);">
                      <span class="glyphicon glyphicon-chevron-down right-float"></span>
                    </a>
                  </div>
                </div>
                <div id="CollapseUsage" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="HeadingUsage">
                  <ul class="nav nav-tabs nav-tabs-usage" id="UsageTab" role="tablist">
                    <!--li role="presentation">
                      <a href="#{{ usage_label }}" role="tab" data-toggle="tab">{{ usage_title }}</a>
                    </li-->
                    <li role="presentation" class="active">
                      <a href="#SynContent" role="tab" data-toggle="tab">quality&nbsp;&nbsp;同义表达</a>
                    </li>
                    <li role="presentation">
                      <a href="#PhraseContent" role="tab" data-toggle="tab">quality&nbsp;&nbsp;常用短语</a>
                    </li>
                    <li role="presentation">
                      <a href="#ColContent" role="tab" data-toggle="tab">quality&nbsp;&nbsp;常用搭配</a>
                    </li>
                  </ul>
                  <div id="UsageContent" class="tab-content">
                    <!--div role="tabpanel" class="tab-pane fade" id="{{ usage_label }}">
                    </div-->
                    <div role="tabpanel" class="tab-pane fade active in" id="SynContent">
                      <div class="usage-panel-content">
                        {% for syn in r.synonymous %}
                        <a href="#">{{ syn }}</a>&nbsp;&nbsp;
                        {% endfor %}
                      </div>
                    </div>
                    <div role="tabpanel" class="tab-pane fade" id="PhraseContent">
                    </div>
                    <div role="tabpanel" class="tab-pane fade" id="ColContent">
                    </div>
                  </div>
                </div>
              </div> <!-- usage panel -->

              <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="HeadingColloc">
                  <div class="panel-title-wrapper">
                    <div class="panel-title display-inline">
                      搭配
                      <span class="panel-subtitle">Collocation</span>
                    </div>
                    <a role="button" data-toggle="collapse" href="#CollapseColloc" aria-expanded="true" aria-controls="CollapseColloc" onclick="$.clickChevron(event);">
                      <span class="glyphicon glyphicon-chevron-down right-float"></span>
                    </a>
                  </div>
                </div>
                <div id="CollapseColloc" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="HeadingColloc">
                  <ul class="nav nav-tabs nav-tabs-collocation" id="CollocationTab" role="tablist">
                    <li role="presentation" class="active">
                      <a href="#CollocAll" role="tab" data-toggle="tab">全部搭配</a>
                    </li>
                    {% for collocation in r.collocationList %}
                    <li role="presentation">
                      <a href="#{{ collocation.label }}" role="tab" data-toggle="tab">{{ collocation.type }}</a>
                    </li>
                    {% endfor %}
                  </ul>
                  <div id="CollocContent" class="tab-content">
                    <div role="tabpanel" class="tab-pane fade active in" id="CollocAll"></div>
                    {% for collocation in r.collocationList %}
                    <div role="tabpanel" class="tab-pane fade" id="{{ collocation.label }}">
                      <div class="row colloc-result">
                        {% for usage in collocation.usageList %}
                        <div class="col-sm-4">
                          <p><a href="">{{ usage.content }}({{ usage.count }})</a></p>
                        </div>
                        {% endfor %}
                        <!--div class="col-sm-4">
                          <p><a href="">{{ usage }}({{ count }})</a></p>
                        </div>
                        <div class="col-sm-4">
                          <p><a href="">{{ usage }}({{ count }})</a></p>
                        </div-->
                      </div>
                    </div>
                    {% endfor %}
                  </div>
                </div>
              </div> <!-- collocation panel -->

            </div> <!-- panel-group -->

            <div id="ExampleList" class="panel-group">
              <div class="example-hint">
                找到{{ example_number }}句例句，为您提供前50个，排序根据点赞和相关度自动生成，耗时{{ search_time }}秒
              </div>
              {% for example in exampleList %}
              <div class="panel panel-default result-example row {% if example.label > 10 %}display-none{% endif %}" id="Example{{ example.label }}">
                <div class="col-xs-11">
                  <div class="panel-body">
                    <div class="display-inline example-list-label">
                      {{ example.label }}.
                    </div>
                    <div class="right-float example-list-content">
                      {{ example.content|safe }}
                    </div>
                  </div>
                  <div class="panel-footer example-list-source">
                    文章来源：{{ example.source }}
                  </div>
                </div>
                <div class="col-xs-1">
                  <div class="panel-heading panel-heart">
                    <a href="" onclick="$.clickHeart(event);"><span class="glyphicon glyphicon-heart-empty"></span></a>
                    <span>{{ example.heart_number }}&nbsp;&nbsp;</span>
                    <a href="" onclick="$.clickStar(event);"><span class="glyphicon glyphicon-star-empty"></span></a>
                  </div>
                </div>
              </div>
              {% endfor %}
            </div> <!-- panel-group -->

            <div id="Loading" class="result-table-cell center-align">
              <p><i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i><span>正在加载</span></p>
            </div>

            <div id="ExampleEnd" class="result-table-cell center-align">
              <span>您已浏览完全部结果</span>
            </div>

          </div>
        </div>

        <div class="col-sm-3 hidden-xs">
          <div id="SidebarAffix" class="affix result-sidebar" data-spy="affix">
            <div class="panel-group">
              <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="HeadingRelated">
                  <div class="result-sidebar-title">
                    大家都在搜
                  </div>
                </div>
                <a role="button" data-toggle="collapse" href="#CollapseRelated" aria-expanded="true" aria-controls="CollapseRelated" onclick="$.clickChevron(event);">
                  <span class="glyphicon glyphicon-chevron-down"></span>
                </a>
                <div id="CollapseRelated" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="HeadingRelated">
                  {% for related in suggestion.relatedList %}
                  <p><a href="">{{ related }}</a></p>
                  {% endfor %}
                </div>
              </div>

              <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="HeadingHot">
                  <div class="result-sidebar-title">
                      领域内热词
                  </div>
                </div>
                <a role="button" data-toggle="collapse" href="#CollapseHot" aria-expanded="true" aria-controls="CollapseHot" onclick="$.clickChevron(event);">
                  <span class="glyphicon glyphicon-chevron-down"></span>
                </a>
                <div id="CollapseHot" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="HeadingHot">
                  {% for hot in suggestion.hotList %}
                  <p><a href="">{{ hot }}</a></p>
                  {% endfor %}
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="back-to-top-cell">
          <div id="BackToTopAffix" class="affix back-to-top-affix" data-spy="affix">
            <div class="btn back-to-top">
              <p class="glyphicon glyphicon-chevron-up"></p>
              <p>回到顶部</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block script %}
  <script>
    $( function() {

      /*----------------- Testing code ------------------*/
      var defList = [
        { label: "主谓", desc: "quality have", value: "quality have", category: "用法示例" },
        { label: "修饰", desc: "quality data", value: "quality data", category: "用法示例" },
        { label: "动宾", desc: "quality of", value: "quality of", category: "用法示例" }
      ];
      var s = {
        list: [
          {
          content: "The crucial <strong>quality</strong> of this active assimilation was that it guaranteed a certain depth in the individual meteorologist's interpretation of the information.",
          source: "UIST'07. M. Morris et. al.SearchTogether: an interface for collaborative web search."
          },
          {
          content: "The crucial <strong>quality</strong> of this active assimilation was that it guaranteed a certain depth in the individual meteorologist's interpretation of the information.",
          source: "UIST'07. M. Morris et. al.SearchTogether: an interface for collaborative web search."
          },
          {
          content: "The crucial <strong>quality</strong> of this active assimilation was that it guaranteed a certain depth in the individual meteorologist's interpretation of the information.",
          source: "UIST'07. M. Morris et. al.SearchTogether: an interface for collaborative web search."
          },
          {
          content: "The crucial <strong>quality</strong> of this active assimilation was that it guaranteed a certain depth in the individual meteorologist's interpretation of the information.",
          source: "UIST'07. M. Morris et. al.SearchTogether: an interface for collaborative web search."
          },
          {
          content: "The crucial <strong>quality</strong> of this active assimilation was that it guaranteed a certain depth in the individual meteorologist's interpretation of the information.",
          source: "UIST'07. M. Morris et. al.SearchTogether: an interface for collaborative web search."
          },
          {
          content: "The crucial <strong>quality</strong> of this active assimilation was that it guaranteed a certain depth in the individual meteorologist's interpretation of the information.",
          source: "UIST'07. M. Morris et. al.SearchTogether: an interface for collaborative web search."
          },
          {
          content: "The crucial <strong>quality</strong> of this active assimilation was that it guaranteed a certain depth in the individual meteorologist's interpretation of the information.",
          source: "UIST'07. M. Morris et. al.SearchTogether: an interface for collaborative web search."
          },
          {
          content: "The crucial <strong>quality</strong> of this active assimilation was that it guaranteed a certain depth in the individual meteorologist's interpretation of the information.",
          source: "UIST'07. M. Morris et. al.SearchTogether: an interface for collaborative web search."
          },
          {
          content: "The crucial <strong>quality</strong> of this active assimilation was that it guaranteed a certain depth in the individual meteorologist's interpretation of the information.",
          source: "UIST'07. M. Morris et. al.SearchTogether: an interface for collaborative web search."
          },
          {
          content: "The crucial <strong>quality</strong> of this active assimilation was that it guaranteed a certain depth in the individual meteorologist's interpretation of the information.",
          source: "UIST'07. M. Morris et. al.SearchTogether: an interface for collaborative web search."
          }
        ],
        ended: false
      };

      $.getData = function( request ) {
        if (typeof(request.term) !== "undefined") {
          var matcher = new RegExp( "^" + request.term, "i" );
          return $.grep( words, function( item ) {
            return matcher.test( item.label );
          });
        }
        switch (request) {
          case "q": return q;
          case "dict": return dict;
          case "suggestion": return suggestion;
          case "r": return r;
          case "example": return s;
          case "": return defList;
          default: return null;
        }
      };

/*
      $.appendExampleList = function( list ) {
        var cur = $("#ExampleList > div").length - 1;
        list.forEach(function (value) {
          var example = $("#ExampleList div:eq(1)").clone().css("display", "block");
          var labelHtml = $(example).children("div:first").children(".panel-body").children(".example-list-label").html();
          var contentHtml = $(example).children("div:first").children(".panel-body").children(".example-list-content").html();
          var sourceHtml = $(example).children("div:first").children(".panel-footer").html();
          var heartnumHtml = $(example).children("div:eq(1)").children("div:first").children("span:first").html();

          $(example).children("div:first").children(".panel-body").children(".example-list-label").html(
              labelHtml.replace("{{ label }}", cur + ". "));
          $(example).children("div:first").children(".panel-body").children(".example-list-content").html(
              contentHtml.replace("{{ content }}", value.content));
          $(example).children("div:first").children(".panel-footer").html(
              sourceHtml.replace("{{ source }}", value.source));
          $(example).children("div:eq(1)").children("div:first").children("span:first").html(heartnumHtml.replace("{{ heart_number }}", "129"));

          $("#ExampleList").append(example);
          cur++;
        });
        $("#ExampleList div:eq(1)").css("display","none");
      };
*/

      (function initialLoading() {
        /*$("#SearchBox").val($("#SearchBox").val().replace("{{ q }}", $.getData("q")));
        $("#SearchKeyWord").html($("#SearchKeyWord").html().replace("{{ q }}", $.getData("q")));

        var dict = $.getData("dict");
        $("#ResultItem").html($("#ResultItem").html().replace("{{ word }}", dict.word));
        $("#EnglishPronounce").html($("#EnglishPronounce").html().replace("{{ english }}", dict.english));
        $("#AmericanPronounce").html($("#AmericanPronounce").html().replace("{{ american }}", dict.american));
        $("#WordExplanation p:first").css("display","none");
        dict.explanation.forEach(function (value) {
          var explanation = $("#WordExplanation p:first").clone().css("display", "block");
          explanation.html(explanation.html().replace("{{ explanation }}", value));
          $("#WordExplanation").append(explanation);
        });

        var r = $.getData("r");
        $("#CountUsage").html($("#CountUsage").html().replace("{{ count }}", r.count));
        $("#SearchDomain").html($("#SearchDomain").html().replace("{{ domain }}", r.domain));

        $("#SynContent div:first a:first").css("display", "none");
        r.synonymous.forEach(function (value) {
          var synonymous = $("#SynContent div:first a:first").clone().css("display", "inline");
          synonymous.html(synonymous.html().replace("{{ synonymous }}", value));
          $("#SynContent div:first").append(synonymous).append("&nbsp;&nbsp;");
        });

        r.collocation.forEach(function (value) {
          var nav = $("#CollocationTab li:eq(1)").clone();
          nav.children("a").attr("href", nav.children("a").attr("href").
                                         replace("{{ collocation_label }}#", "#"+value.label));
          nav.children("a").html(nav.children("a").html().replace("{{ collocation }}", value.type));
          $("#CollocationTab").append(nav);

          var content = $("#CollocContent div:eq(1)").clone();
          content.attr("id", content.attr("id").replace("{{ collocation_label }}", value.label));
          if (value.usage) {
            var i = 0;
            value.usage.forEach(function (usage) {
              var contentItem = content.children("div").children("div:eq(" + i + ")").
                                children("p:first").clone();
              contentItem.html(contentItem.html().
                               replace("{{ usage }}", usage.content).replace("{{ count }}", usage.count));
              content.children("div").children("div:eq(" + i + ")").append(contentItem);
              i = (i + 1) % 3;
            });
          }
          content.children("div").children("div:eq(0)").children("p:first").css("display", "none");
          content.children("div").children("div:eq(1)").children("p:first").css("display", "none");
          content.children("div").children("div:eq(2)").children("p:first").css("display", "none");
          $("#CollocContent").append(content);
        });
        $("#CollocationTab li:eq(1)").css("display", "none");
        $("#CollocContent div:eq(1)").css("display", "none");

        var suggestion = $.getData("suggestion");
        suggestion.related.forEach(function (value) {
          var related = $("#CollapseRelated p:first").clone();
          related.html(related.html().replace("{{ related }}", value));
          $("#CollapseRelated").append(related);
        });
        suggestion.hot.forEach(function (value) {
          var hot = $("#CollapseHot p:first").clone();
          hot.html(hot.html().replace("{{ hot }}", value));
          $("#CollapseHot").append(hot);
        });
        $("#CollapseRelated p:first").css("display", "none");
        $("#CollapseHot p:first").css("display", "none");
      

        var example = $.getData("example");
        $.appendExampleList( example.list );
        if (example.ended) {
          $("#ExampleEnd").show();
          loaded = 1;
        }
        */
        //$("#ExampleList div:first").html($("#ExampleList div:first").html().replace("{{ example_number }}", "1209").replace("{{ search_time }}", "0.1"));
      })();
      /*----------------- Testing code ------------------*/
    } );
    </script>
  <script src="{% static 'js/esoda-result.js' %}"></script>
{% endblock %}
