{% extends "base.html" %}
{% load static %}
{% load i18n %}

{% block title %}ESODA | search result{% endblock %}

{% block head %}
  <link href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">
{% endblock %}

{% block content %}

  <div class="result-page">
    <div class="container">
      <div class="row">
        <div class="col-sm-9 result-main">
          <div>

            <div class="result-warning">
              当前个人领域为"<span id="SearchDomain">{{ r.domain }}</span>"，搜索"<span id="SearchKeyWord">{{ q }}</span>"结果共<span id="CountUsage">{{ r.count }}</span>句例句，在其他<a href="#">个人领域</a>中搜索
            </div>

            <div class="panel-group" role="tablist" aria-multiselectable="true">
            {% if dictionary %}
              {% include "esoda/dictionary_result.html" %}
            {% endif %}

              <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="HeadingUsage">
                  <div class="panel-title-wrapper">
                    <div class="panel-title display-inline">
                      用法
                      <span class="panel-subtitle">Usage</span>
                    </div>
                    <a role="button" data-toggle="collapse" href="#CollapseUsage" aria-expanded="true" aria-controls="CollapseUsage" onclick="$.clickChevron(event);">
                      <span class="glyphicon glyphicon-chevron-up right-float"></span>
                    </a>
                  </div>
                </div>
                <div id="CollapseUsage" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="HeadingUsage">
                  <ul class="nav nav-tabs nav-tabs-usage" id="UsageTab" role="tablist">
                    <!--li role="presentation">
                      <a href="#{{ usage_label }}" role="tab" data-toggle="tab">{{ usage_title }}</a>
                    </li-->
                    {% if r.synonymous %}
                    <li role="presentation" class="active">
                      <a href="#SynContent" role="tab" data-toggle="tab">{{ q }}&nbsp;&nbsp;同义表达</a>
                    </li>
                    {% endif %}
                    {% if r.phrase %}
                    <li role="presentation">
                      <a href="#PhraseContent" role="tab" data-toggle="tab">{{ q }}&nbsp;&nbsp;常用短语</a>
                    </li>
                    {% endif %}
                    {% if r.commonColloc%}
                    <li role="presentation">
                      <a href="#ColContent" role="tab" data-toggle="tab">{{ q }}&nbsp;&nbsp;常用搭配</a>
                    </li>
                    {% endif %}
                  </ul>
                  <div id="UsageContent" class="tab-content">
                    {% if r.synonymous %}
                    <div role="tabpanel" class="tab-pane fade active in" id="SynContent">
                      <div class="usage-panel-content">
                        {% for syn in r.synonymous %}
                        <a href="{% url 'esoda' %}?q={{ syn }}">{{ syn }}</a>&nbsp;&nbsp;
                        {% endfor %}
                      </div>
                    </div>
                    {% endif %}
                    {% if r.phrase %}
                    <div role="tabpanel" class="tab-pane fade" id="PhraseContent">
                      <div class="usage-panel-content">
                        {% for phr in r.phrase %}
                        <a href="{% url 'esoda' %}?q={{ phr }}">{{ phr }}</a>
                        {% if not forloop.last %},{% endif %}&nbsp;
                        {% endfor %}
                      </div>
                    </div>
                    {% endif %}
                    {% if r.commonColloc %}
                    <div role="tabpanel" class="tab-pane fade" id="ColContent">
                      <div class="usage-panel-content">
                        {% for ccol in r.commonColloc %}
                        <a href="{% url 'esoda' %}?q={{ ccol }}">{{ ccol }}</a>
                        {% if not forloop.last %},{% endif %}&nbsp;
                        {% endfor %}
                      </div>
                    </div>
                    {% endif %}
                  </div>
                </div>
              </div> <!-- usage panel -->

              {% if r.collocationList %}
              <div class="panel panel-default">
                <div class="panel-heading" role="tab" id="HeadingColloc">
                  <div class="panel-title-wrapper">
                    <div class="panel-title display-inline">
                      搭配
                      <span class="panel-subtitle">Collocation</span>
                    </div>
                    <a role="button" data-toggle="collapse" href="#CollapseColloc" aria-expanded="true" aria-controls="CollapseColloc" onclick="$.clickChevron(event);">
                      <span class="glyphicon glyphicon-chevron-up right-float"></span>
                    </a>
                  </div>
                </div>
                <div id="CollapseColloc" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="HeadingColloc">
                  <ul class="nav nav-tabs nav-tabs-collocation" id="CollocationTab" role="tablist">
                    <li role="presentation" class="active">
                      <a href="#CollocAll" role="tab" data-toggle="tab">不限制</a>
                    </li>
                    {% for collocation in r.collocationList %}
                    <li role="presentation">
                      <a href="#{{ collocation.label }}" role="tab" data-toggle="tab">{{ collocation.type }}</a>
                    </li>
                    {% endfor %}
                  </ul>
                  <div id="CollocContent" class="tab-content">
                    <div role="tabpanel" class="tab-pane fade active in" id="CollocAll"></div>
                    {% for collocation in r.collocationList %}
                    <div role="tabpanel" class="tab-pane fade" id="{{ collocation.label }}">
                      <div class="row colloc-result">
                        {% for usage in collocation.usageList %}
                        <div class="col-sm-4">
                          <p><a href="#" class="colloc-usage" id="CollocationUsage{{ forloop.counter }}">{{ usage.content }} ({{ usage.count }})</a></p>
                        </div>
                        {% endfor %}
                      </div>
                    </div>
                    {% endfor %}
                  </div>
                </div>
              </div> <!-- collocation panel -->
              {% endif %}

            </div> <!-- panel-group -->

            <div id="SentenceResult"></div>

            <div id="Loading" class="result-table-cell center-align">
              <p><i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i><span>正在加载</span></p>
            </div>

            <div id="ExampleEnd" class="result-table-cell center-align">
              <span>您已浏览完全部结果</span>
            </div>

          </div>
        </div>

        <div class="col-sm-3 hidden-xs">
          <div id="SidebarAffix" class="affix result-sidebar" data-spy="affix">
            <div class="panel-group">
              <div class="panel panel-default sideword">
                <div class="panel-heading" role="tab" id="HeadingRelated">
                  <div class="result-sidebar-title">
                    大家都在搜
                  </div>
                </div>
                <a role="button" data-toggle="collapse" href="#CollapseRelated" aria-expanded="true" aria-controls="CollapseRelated" onclick="$.clickChevron(event);">
                  <span class="glyphicon glyphicon-chevron-up"></span>
                </a>
                <div id="CollapseRelated" class="hotword panel-collapse collapse in" role="tabpanel" aria-labelledby="HeadingRelated">
                  {% for related in suggestion.relatedList %}
                  <p><a href="{% url 'esoda' %}?q={{ related }}">{{ related }}</a></p>
                  {% endfor %}
                </div>
              </div>

              <div class="panel panel-default sideword">
                <div class="panel-heading" role="tab" id="HeadingHot">
                  <div class="result-sidebar-title">
                      领域内热词
                  </div>
                </div>
                <a role="button" data-toggle="collapse" href="#CollapseHot" aria-expanded="true" aria-controls="CollapseHot" onclick="$.clickChevron(event);">
                  <span class="glyphicon glyphicon-chevron-up"></span>
                </a>
                <div id="CollapseHot" class="panel-collapse collapse in hotword" role="tabpanel" aria-labelledby="HeadingHot">
                  {% for hot in suggestion.hotList %}
                  <p><a href="{% url 'esoda' %}?q={{ hot }}">{{ hot }}</a></p>
                  {% endfor %}
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="back-to-top-cell">
          <div id="BackToTopAffix" class="affix back-to-top-affix" data-spy="affix">
            <div class="btn back-to-top">
              <p class="glyphicon glyphicon-chevron-up"></p>
              <p>回到顶部</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block script %}
  <script src="{% static 'js/esoda-result.js' %}"></script>
  <script>
    $( function() {
      $('#CollapseColloc').on('click', '.colloc-usage', function (e) {
        e.preventDefault();
        $("#ExampleEnd").hide();
        $("#SentenceResult").html("<h3>Loading...</h3>");

        var collocQ = $(this).text().split(' ')[0].replace('...', ' ');
        var dtype = $(this).parents('.tab-pane').attr('id').replace('Colloc', '');
        loadCount = 1;
        loading = 0;
        loaded = 0;
        var dt = (Number(dtype) - 1) % 4 + 1;

        console.log(collocQ + ' ' + dt);
        $.get("{% url 'sentences' %}", {q: collocQ, dtype: dtype}, function(data) {
          $("#SentenceResult").html(data);
        });
      });

      loadCount = 1;
      loading = 0;
      loaded = 0;
      $.get("{% url 'sentences' %}", {q: $("#SearchBox").val(), dtype: "0"}, function(data) {
        $("#SentenceResult").html(data);
      });
    } );
  </script>
{% endblock %}
