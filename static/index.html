<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="favicon.ico">

    <title>Esoda</title>

    <!-- Bootstrap core CSS -->
    <link href="http://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <link href="http://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" rel="stylesheet">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="css/ie10-viewport-bug-workaround.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/style.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="js/ie-emulation-modes-warning.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="js/jquery-ui.js"></script>
    <script>
    $( function() {
      /* -------------------- Testing code -------------------- */
      var words = [
        { label: "survey", desc: "调查.测验", category: "Words" },
        { label: "upset", desc: "心烦意乱的;不安的,不适的", category: "Words" },
        { label: "ignore", desc: "不理睬.忽视", category: "Words" },
        { label: "concern", desc: "(使)担心:涉及;关系到 n 担心;关注.(利害)关系", category: "Words" },
        { label: "vet", desc: "兽医", category: "Words" },
        { label: "Amsterdam", desc: "阿姆斯特丹(荷兰首都)", category: "Words" },
        { label: "Netherlands", desc: "荷兰(西欧国家)", category: "Words" },
        { label: "Jew", desc: "犹太人的;犹太族的", category: "Words" },
        { label: "German", desc: "德国的.德国人的.德语的.", category: "Words" },
        { label: "Nazi", desc: "纳粹党人 adj 纳粹党的", category: "Words" },
        { label: "series", desc: "连续,系列", category: "Words" },
        { label: "outdoors", desc: "在户外.在野外", category: "Words" },
        { label: "spellbind", desc: "迷住;疑惑", category: "Words" },
        { label: "purpose", desc: "故意", category: "Words" },
        { label: "dusk", desc: "黄昏傍晚", category: "Words" },
        { label: "loose", desc: "adj 松的.松开的", category: "Words" },
        { label: "entire", desc: "adj 整个的;完全的,全部的", category: "Words" },
        { label: "entirely", desc: "ady. 完全地.全然地.整个地", category: "Words" },
        { label: "power", desc: "能力.力量.权力。", category: "Words" },
        { label: "thunder", desc: "vi 打雷雷鸣 n 雷,雷声", category: "Words" },
        { label: "curtain", desc: "窗帘;门帘.幕布", category: "Words" },
        { label: "dusty", desc: "adj 积满灰尘的", category: "Words" },
        { label: "partner", desc: "伙伴.合作者.合伙人", category: "Words" },
        { label: "settle", desc: "安家.定居.停留 vt 使定居.安排.解决", category: "Words" },
        { label: "suffer", desc: "vt &遭受;忍受经历", category: "Words" },
        { label: "loneliness", desc: "孤单寂寞", category: "Words" },
        { label: "highway", desc: "高速公路", category: "Words" },
        { label: "recover", desc: "痊愈;恢复", category: "Words" },
        { label: "pack", desc: "捆扎;包装打行李 n 小包:包裹", category: "Words" },
        { label: "suitcase", desc: "手提箱;衣箱", category: "Words" },
        { label: "overcoat", desc: "大衣外套", category: "Words" },
        { label: "teenager", desc: "十几岁的青少年", category: "Words" },
        { label: "gossip", desc: "闲话 闲谈", category: "Words" },
        { label: "exactly", desc: "确实如此.正是;确切地山", category: "Words" },
        { label: "disagree", desc: "不同意", category: "Words" },
        { label: "grateful", desc: "感激的.表示谢意的", category: "Words" },
        { label: "dislike", desc: "不喜欢.厌恶", category: "Words" },
        { label: "tip", desc: "提示.技巧.尖;尖端.小费 倾斜;翻倒", category: "Words" },
        { label: "secondly", desc: "第二.其次", category: "Words" },
        { label: "swap", desc: "交换", category: "Words" },
        { label: "item", desc: "项目.条款", category: "Words" },
        { label: "subway", desc: "<美>地铁", category: "Words" },
        { label: "elevator", desc: "n 电梯;升降机", category: "Words" },
        { label: "petrol", desc: "<英>汽油( = <美> gasoline )", category: "Words" },
        { label: "gasoline", desc: "汽油.气体.煤气;毒气。", category: "Words" },
        { label: "official", desc: "adj 官方的.正式的.公务的", category: "Words" },
        { label: "voyage", desc: "n 航行.航海", category: "Words" },
        { label: "conquer", desc: "征服.占领", category: "Words" },
        { label: "native", desc: "本国的;本地的 n 本地人.本国人", category: "Words" },
        { label: "apartment", desc: "<美>公寓住宅.单元住宅", category: "Words" },
        { label: "actually", desc: "实际上,事实上", category: "Words" },
        { label: "base", desc: "根据 n 基部;基地,墓础", category: "Words" },
        { label: "gradual", desc: "逐渐的.逐步的", category: "Words" },
        { label: "enrich", desc: "使富裕;充实,改善", category: "Words" },
        { label: "vocabulary", desc: "词汇.词汇量.词表", category: "Words" },
        { label: "spelling", desc: "拼写.拼法", category: "Words" },
        { label: "latter", desc: "较后的后平的;(两者中)后者的 .", category: "Words" },
        { label: "identity", desc: "本身.本体", category: "Words" },
        { label: "fluent", desc: "流利的.流畅的", category: "Words" },
        { label: "frequent", desc: "adj 频繁的.常见的", category: "Words" },
        { label: "usage", desc: "使用.用法.词语惯用法", category: "Words" },
        { label: "command", desc: "命令;指令;把握", category: "Words" },
        { label: "request", desc: "哀求;要求", category: "Words" },
        { label: "dialect", desc: "方言", category: "Words" },
        { label: "expression", desc: "词语;表示表达", category: "Words" },
        { label: "midwestern", desc: "中西部的.有中西部特性的", category: "Words" },
        { label: "African", desc: "adj 非洲的:非洲人的;非洲语言的", category: "Words" },
        { label: "lightning", desc: "闪电", category: "Words" },
        { label: "straight", desc: "街区", category: "Words" },
        { label: "cab", desc: "出租车", category: "Words" },
        { label: "journal", desc: "日记;杂志.定期刊物", category: "Words" },
        { label: "transport", desc: "运送.运输", category: "Words" },
        { label: "prefer", desc: "更喜欢选择某事物而不选择其他事物", category: "Words" },
        { label: "disadvantage", desc: "不利条件;不便之处", category: "Words" },
        { label: "fare", desc: "费用", category: "Words" },
        { label: "route", desc: "人路线.路途", category: "Words" },
        { label: "flow", desc: "流动.流出 n 流动.流量", category: "Words" },
        { label: "persuade", desc: "说服.劝说", category: "Words" },
        { label: "cycle", desc: "骑自行车", category: "Words" },
        { label: "graduate", desc: "毕业 n 大学毕业生", category: "Words" },
        { label: "finally", desc: "最后.终于", category: "Words" },
        { label: "schedule", desc: "进度表", category: "Words" },
        { label: "fond", desc: "心喜爱的.慈祥的宠爱的", category: "Words" },
        { label: "stubborn", desc: "顽固的;固执的", category: "Words" },
        { label: "organize", desc: "组织,成立", category: "Words" },
        { label: "detail", desc: "细节;详情", category: "Words" },
        { label: "determine", desc: "讨决定;确定;下定决心", category: "Words" },
        { label: "journey", desc: "旅行.旅程", category: "Words" },
        { label: "altitude", desc: "海拔高度.高处", category: "Words" },
        { label: "valley", desc: "谷流域", category: "Words" },
        { label: "waterfall", desc: "瀑布", category: "Words" },
        { label: "pace", desc: "缓漫而行.踱步入一步.速度;步调", category: "Words" },
        { label: "bend", desc: "弯,拐角", category: "Words" },
        { label: "meander", desc: "蜿蜒缓慢流动飞", category: "Words" },
        { label: "attitude", desc: "看法", category: "Words" },
        { label: "forecast", desc: "猜测;预告", category: "Words" },
        { label: "parcel", desc: "小包;包裹", category: "Words" },
        { label: "insurance", desc: "保险", category: "Words" },
        { label: "wool", desc: "羊毛.毛织", category: "Words" },
        { label: "add up", desc: "合计", category: "Expressions" },
        { label: "have got to", desc: "不得不;必须", category: "Expressions" },
        { label: "be concerned about", desc: "关心.挂念", category: "Expressions" },
        { label: "walk the dog", desc: "遇狗", category: "Expressions" },
        { label: "go through", desc: "经历;经受", category: "Expressions" },
        { label: "set down", desc: "记下;放下.登记", category: "Expressions" },
        { label: "a series of", desc: "一连串的.一系列;一套", category: "Expressions" },
        { label: "in order to", desc: "为了", category: "Expressions" },
        { label: "at dusk", desc: "在黄昏时刻", category: "Expressions" },
        { label: "face to face", desc: "面对面地", category: "Expressions" },
        { label: "no longer/not any longer", desc: "不再", category: "Expressions" },
        { label: "suffer from", desc: "遭受.患病", category: "Expressions" },
        { label: "get/be tired of", desc: "对 厌烦", category: "Expressions" },
        { label: "pack ( sth ) up", desc: "将(东西)装箱打包", category: "Expressions" },
        { label: "get along with", desc: "与 相处.进展", category: "Expressions" },
        { label: "fall in love", desc: "相爱;爱上", category: "Expressions" },
        { label: "join in", desc: "参加.加入", category: "Expressions" },
        { label: "because of", desc: "因为", category: "Expressions" },
        { label: "come up", desc: "走近,上来.提出", category: "Expressions" },
        { label: "at present", desc: "现在;目前", category: "Expressions" },
        { label: "make use of", desc: "利用 使用", category: "Expressions" },
        { label: "play a part ( in )", desc: "扮演个角色:参与", category: "Expressions" },
        { label: "ever since", desc: "从那以后", category: "Expressions" },
        { label: "be fond of", desc: "喜爱;喜欢", category: "Expressions" },
        { label: "short coming", desc: "缺点", category: "Expressions" },
        { label: "care about", desc: "关心;忧虑;", category: "Expressions" },
        { label: "change one’s mind", desc: "改变主意", category: "Expressions" },
        { label: "make up one’s mind", desc: "下决心.决定", category: "Expressions" },
        { label: "give in", desc: "投降.屈服.让步", category: "Expressions" },
        { label: "as usual", desc: "照常", category: "Expressions" }
      ];
      var defList = [
        { label: "主谓", desc: "quality have", value: "quality have", category: "用法示例" },
        { label: "修饰", desc: "quality data", value: "quality data", category: "用法示例" },
        { label: "动宾", desc: "quality of", value: "quality of", category: "用法示例" }
      ];
      function getData( request ) {
        if (request == "") {
          return defList;
        } else {
          var matcher = new RegExp( "^" + request, "i" );
          return $.grep( words, function( item ) {
            return matcher.test( item.label );
          });
        }
      }
      /* -------------------- Testing code --------------------- */

      Storage.prototype.setObj = function(key, obj) {
        return this.setItem(key, JSON.stringify(obj))
      }
      Storage.prototype.getObj = function(key) {
        return JSON.parse(this.getItem(key))
      }
      function setCookie(cname, cvalue, exdays) {
        var d = new Date();
        d.setTime(d.getTime() + (exdays*24*60*60*1000));
        var expires = "expires="+ d.toUTCString();
        document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
      } 
      function getCookie(cname) {
        var name = cname + "=";
        var decodedCookie = decodeURIComponent(document.cookie);
        var ca = decodedCookie.split(';');
        for(var i = 0; i <ca.length; i++) {
          var c = ca[i];
          while (c.charAt(0) == ' ') {
            c = c.substring(1);
          }
          if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length);
          }
        }
        return "";
      }

      function insertHistory(history, val) {
        if (history.length > 0) {
          history = history.filter(function(item) {
            return item !== val;
          });
        }
        history.unshift(val);
        if (history.length > 5) history.pop();
        return history;
      }

      function clearHistory() {
        if (("localStorage" in window) && window.localStorage !== null) {
          localStorage.setObj("history", []);
        } else {
          setCookie("history", "[]", 365);
        }
      }

      function storeHistory() {
        if ($("#SearchBox").val().length == 0) return;
        if (("localStorage" in window) && window.localStorage !== null) {
          var history = localStorage.getObj("history");
          history = insertHistory(history, $("#SearchBox").val());
          localStorage.setObj("history", history);
        } else {
          var history = JSON.parse(getCookie("history"));
          history = insertHistory(history, $("#SearchBox").val());
          setCookie("history", JSON.stringify(history), 365);
        }
      }

      function readHistory() {
        if (("localStorage" in window) && window.localStorage !== null) {
          var history = localStorage.getObj("history");
          if (history == null) {
            history = [];
            localStorage.setObj("history", history);
          }
        } else {
          var history = JSON.parse(getCookie("history"));
          if (history == "") {
            history = [];
            setCookie("history", JSON.stringify(history), 365);
          }
        }

        defaultList = $.map(history, function( value ) {
          return {label: value, desc: "", category: "最近搜过"};
        });
      }


      var defaultList = [];
      //clearHistory();
      readHistory();
      defaultList = defaultList.concat(getData(""));
      /*
      var defaultList = [];
      $.getJSON( "search.php", "", function(data, status, xhr) {
        defaultList = data;
      });
      */

      $( "#SearchBox" ).val("");

      $.widget( "custom.catcomplete", $.ui.autocomplete, {
        _create: function() {
          this._super();
          this.widget().menu( "option", "items", "> :not(.ui-autocomplete-category)" );
        },
        _renderMenu: function( ul, items ) {
          var that = this,
            currentCategory = "";
          $.each( items, function( index, item ) {
            var li;
            if ( item.category != currentCategory ) {
              ul.append( "<li class='ui-autocomplete-category'>" + item.category + "</li>" );
              currentCategory = item.category;
            }
            li = that._renderItemData( ul, item );
            if ( item.category ) {
              li.attr( "aria-label", item.category + " : " + item.label );
            }
          });
        },
        _renderItem: function( ul, item ) {
          return $( "<li>" )
            .append( "<div><span class=\"ui-autocomplete-label\">" + item.label + "</span>" +
                     "&nbsp;&nbsp;<span class=\"ui-autocomplete-desc\">" + item.desc + "</span></div>" )
            .appendTo( ul );
        }
      });
      
      function split( val ) {
        return val.split( /\s+/ );
      }
      function extractLast( term ) {
        return split( term ).pop();
      }
      

      var cache = {};
      $( "#SearchBox" ).catcomplete({
        minLength: 0,
        source: function( request, response ) {
          /*
          var matcher = new RegExp( "^" + $.ui.autocomplete.escapeRegex( request.term ), "i" );
          response( $.grep( words, function( item ){
              return matcher.test( item.label );
          }) );
          */

          var term = extractLast( request.term );
          if ( term.length < 1) {
            response( defaultList );
            return;
          }

          if (term in cache) {
            response( cache[ term ] );
            return;
          }

          var data = getData( term );
          cache[ term ] = data;
          response( data );
          /*
          $.getJSON( "search.php", request.term, function(data, status, xhr) {
            cache[ term ] = data;
            response( data );
          });
          */

      	},
        search: function() {
          if (this.value.length == 0) return true;
          var term = extractLast( this.value );
          if ( term.length < 1 ) {
            return false;
          }
        },
        focus: function( event, ui ) {
          return false;
        },
        select: function( event, ui ) {
          var terms = split( this.value );
          terms.pop();
          terms.push( ui.item.value );
          this.value = terms.join( " " );
          if (event.keyCode !== $.ui.keyCode.TAB)
            $( "#SearchForm" ).submit();
          else
            this.value += " ";
          return false;

          /*
          this.value = ui.item.value;
          $( "#SearchForm" ).submit();
          return false;
          */
        }
      })
      .focus(function() {
        if (this.value == "")
          $(this).catcomplete("search", "");
      });

      $("#SearchForm").on("submit", storeHistory);

      $("#AddBookmark").click(function(e){
        e.preventDefault();
        var bookmarkUrl = window.location.href;
        var bookmarkTitle = document.title;

        if ("addToHomescreen" in window && addToHomescreen.isCompatible) { // Mobile browsers
          addToHomescreen({ autostart: false, startDelay: 0 }).show(true);
        } else if (window.sidebar && window.sidebar.addPanel) { // Firefox <=22
          window.sidebar.addPanel(document.title, window.location.href,'');
        } else if ((window.sidebar && /Firefox/i.test(navigator.userAgent))
                   || (window.opera && window.print)) { // Firefox 23+ and Opera <=14 
          $(this).attr({
            href: bookmarkUrl,
            title: bookmarkTitle,
            rel: "sidebar"
          }).off(e);
          return true;
        } else if( window.external && ("AddFavorite" in window.external)) { // For IE Favorite
          window.external.AddFavorite( bookmarkUrl, bookmarkTitle);
        } else { // for other browsers which does not support (Chrome/Safari/Opera15+)
          alert("您的浏览器不支持该操作。\n请按 " +
                (navigator.userAgent.toLowerCase().indexOf('mac') != -1 ? 'Command/Cmd' : 'CTRL') +
                "+D 添加收藏。");
        }
        return false;
      });
    } );
    </script>
  </head>

  <body>

    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand esoda-brand" href="index.html">Esoda</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav nav-pills navbar-right nav-pills-reg" role="tablist">
            <li role="presentation"><a href="#">登陆</a></li>
            <li role="presentation" class="active"><a href="#">注册</a></li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li><a id="AddBookmark" href="#" title="Bookmark this page">添加收藏</a></li>
            <li><a href="#">联系方式</a></li>
            <li><a href="#">关于我们</a></li>
          </ul>
        </div><!--/.navbar-collapse -->
      </div>
    </nav>

    <!-- Main jumbotron for a primary marketing message or call to action -->
    <div class="jumbotron">
      <div class="container main-container">
        <div class="row">
          <h1 class="esoda-brand col-xs-6 col-xs-offset-3 col-sm-4 col-sm-offset-4 title">Esoda</h1>
          <div id="SearchBar" class="col-xs-10 col-xs-offset-1 col-sm-6 col-sm-offset-3">
            <form id="SearchForm" class="form-horizontal" role="search" action="result.html">
              <div class="input-group input-group-lg">
                <!-- The "Search" icon cannot be placed into searchbox-->
                <!--span class="glyphicon glyphicon-search"></span-->
                <input id="SearchBox" type="text" class="form-control" placeholder="想搜什么？" name="q"/>
                <span class="input-group-btn">
                  <button type="submit" class="btn btn-info">搜索</button>
                </span>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="container container-usage">
      <h4 class="usage-title">如何使用</h4>
      <div class="row">
        <div class="col-sm-6 col-md-3 col-guide">
          <div class="thumbnail thumbnail-guide">
            <img src="images/img1.png" alt="...">
            <div class="caption caption-usage">
              <h4 style="font-style: italic">circumstance? (semantic)</h4>
              <p>...</p>
            </div>
          </div>
        </div>
        <div class="col-sm-6 col-md-3 col-guide">
          <div class="thumbnail thumbnail-guide">
            <img src="images/img1.png" alt="...">
            <div class="caption caption-usage">
              <h4 style="font-style: italic">circumstance? (semantic)</h4>
              <p>...</p>
            </div>
          </div>
        </div>
        <div class="col-sm-6 col-md-3 col-guide">
          <div class="thumbnail thumbnail-guide">
            <img src="images/img1.png" alt="...">
            <div class="caption caption-usage">
              <h4 style="font-style: italic">circumstance? (semantic)</h4>
              <p>...</p>
            </div>
          </div>
        </div>
        <div class="col-sm-6 col-md-3 col-guide">
          <div class="thumbnail thumbnail-guide">
            <img src="images/img1.png" alt="...">
            <div class="caption caption-usage">
              <h4 style="font-style: italic">circumstance? (semantic)</h4>
              <p>...</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-feedback">
      <div class="container">
        <h4 class="usage-title">师兄评价</h4>
        <div class="row">
          <div class="col-sm-6 col-md-4 col-comments">
            <div class="thumbnail">
              <img src="images/img2.png" alt="...">
              <div class="caption" style="margin-top: 30px">
                <p style="font-size:14px">好用好用很好用！Esoda给了我很多帮助，赞！</p>
                <h4 style="margin-top:30px">王海超</h4>
                <h4>Google</h4>
              </div>
            </div>
          </div>
          <div class="col-sm-6 col-md-4 col-comments">
            <div class="thumbnail">
              <img src="images/img2.png" alt="...">
              <div class="caption" style="margin-top: 30px">
                <p style="font-size:14px">好用好用很好用！Esoda给了我很多帮助，赞！</p>
                <h4 style="margin-top:30px">王海超</h4>
                <h4>Google</h4>
              </div>
            </div>
          </div>
          <div class="col-sm-6 col-md-4 col-comments">
            <div class="thumbnail">
              <img src="images/img2.png" alt="...">
              <div class="caption" style="margin-top: 30px">
                <p style="font-size:14px">好用好用很好用！Esoda给了我很多帮助，赞！</p>
                <h4 style="margin-top:30px">王海超</h4>
                <h4>Google</h4>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>


    <footer class="footer">
      <div class="container container-footer">
        <div class="row">
          <div class="col-sm-3 col-md-2 col-md-offset-2">
            <p><a href="#" class="footer-link">FOOTER链接</a></p>
          </div>
          <div class="col-sm-3 col-md-2">
            <p><a href="#" class="footer-link">FOOTER链接</a></p>
          </div>
          <div class="col-sm-3 col-md-2">
            <p><a href="#" class="footer-link">FOOTER链接</a></p>
          </div>
          <div class="col-sm-3 col-md-2">
            <p><a href="#" class="footer-link">FOOTER链接</a></p>
          </div>
        </div>
        <p class="copyright col-sm-4 col-sm-offset-4">Esoda &copy; 2012-2017.</p>
      </div>
    </footer>


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!-- script src="http://cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script -->
    <script src="http://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="js/ie10-viewport-bug-workaround.js"></script>
  </body>
</html>
