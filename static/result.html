<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="favicon.ico">

    <title>Esoda</title>

    <!-- Bootstrap core CSS -->
    <link href="http://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="css/ie10-viewport-bug-workaround.css" rel="stylesheet">

    <link href="http://cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="css/style.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="js/ie-emulation-modes-warning.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script src="http://cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>
    <script src="http://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script>
    // TODO: put some of the js code into .js
    $( function() {
      $("#CollocationTab a").click(function (e) {
        e.preventDefault();
        $(this).tab("show");
      })

      var loadCount = 1, loading = 0, loaded = 0;

      /*----------------- Testing code ------------------*/
      
      var q = "quality";
      var dict = {
        word: "quality",
        english: "['kwɒlɪtɪ]",
        american: "['kwɑləti]",
        explanation: [
          "n. 质量，[统计] 品质；特性；才能",
          "adj. 优质的；高品质的；&lt;英俚&gt;棒极了"
        ]
      };
      var suggestion = {
        related: [
          "high quality",
          "improve quality",
          "ensure quality",
          "*(修饰) quality"
        ],
        hot: []
      }
      var r = {
        domain: "人机交互",
        count: 222,
        synonymous: [
          "trait",
          "characteristic",
          "feature",
          "attribute",
          "property"
        ],
        collocation: [
          {
            type: "quality (主谓)*",
            label: "Colloc1",
            usage: [
              {
                content: "improve...quality",
                count: 609
              },
              {
                content: "improve...quality",
                count: 609
              },
              {
                content: "improve...quality",
                count: 609
              },
              {
                content: "evaluate...quality",
                count: 185
              },
              {
                content: "evaluate...quality",
                count: 185
              },
              {
                content: "evaluate...quality",
                count: 185
              },
              {
                content: "measure...quality",
                count: 173
              },
              {
                content: "measure...quality",
                count: 173
              },
              {
                content: "measure...quality",
                count: 173
              },
              {
                content: "assess...quality",
                count: 149
              },
              {
                content: "assess...quality",
                count: 149
              },
              {
                content: "assess...quality",
                count: 149
              }
            ],
            count: 12
          },
          {
            type: "quality (修饰)*",
            label: "Colloc2"
          },
          {
            type: "quality (介词)*",
            label: "Colloc3"
          },
          {
            type: "*(修饰) quality",
            label: "Colloc4"
          },
        ]
      }
      var s = {
        list: [
          {
          content: "The crucial <strong>quality</strong> of this active assimilation was that it guaranteed a certain depth in the individual meteorologist's interpretation of the information.",
          source: "UIST'07. M. Morris et. al.SearchTogether: an interface for collaborative web search."
          },
          {
          content: "The crucial <strong>quality</strong> of this active assimilation was that it guaranteed a certain depth in the individual meteorologist's interpretation of the information.",
          source: "UIST'07. M. Morris et. al.SearchTogether: an interface for collaborative web search."
          },
          {
          content: "The crucial <strong>quality</strong> of this active assimilation was that it guaranteed a certain depth in the individual meteorologist's interpretation of the information.",
          source: "UIST'07. M. Morris et. al.SearchTogether: an interface for collaborative web search."
          },
          {
          content: "The crucial <strong>quality</strong> of this active assimilation was that it guaranteed a certain depth in the individual meteorologist's interpretation of the information.",
          source: "UIST'07. M. Morris et. al.SearchTogether: an interface for collaborative web search."
          },
          {
          content: "The crucial <strong>quality</strong> of this active assimilation was that it guaranteed a certain depth in the individual meteorologist's interpretation of the information.",
          source: "UIST'07. M. Morris et. al.SearchTogether: an interface for collaborative web search."
          },
          {
          content: "The crucial <strong>quality</strong> of this active assimilation was that it guaranteed a certain depth in the individual meteorologist's interpretation of the information.",
          source: "UIST'07. M. Morris et. al.SearchTogether: an interface for collaborative web search."
          },
          {
          content: "The crucial <strong>quality</strong> of this active assimilation was that it guaranteed a certain depth in the individual meteorologist's interpretation of the information.",
          source: "UIST'07. M. Morris et. al.SearchTogether: an interface for collaborative web search."
          },
          {
          content: "The crucial <strong>quality</strong> of this active assimilation was that it guaranteed a certain depth in the individual meteorologist's interpretation of the information.",
          source: "UIST'07. M. Morris et. al.SearchTogether: an interface for collaborative web search."
          },
          {
          content: "The crucial <strong>quality</strong> of this active assimilation was that it guaranteed a certain depth in the individual meteorologist's interpretation of the information.",
          source: "UIST'07. M. Morris et. al.SearchTogether: an interface for collaborative web search."
          },
          {
          content: "The crucial <strong>quality</strong> of this active assimilation was that it guaranteed a certain depth in the individual meteorologist's interpretation of the information.",
          source: "UIST'07. M. Morris et. al.SearchTogether: an interface for collaborative web search."
          }
        ],
        ended: false
      };

      function getData( request ) {
        switch (request) {
          case "q": return q;
          case "dict": return dict;
          case "suggestion": return suggestion;
          case "r": return r;
          case "example": return s;
          default: return null;
        }
      }

      function appendExampleList( list ) {
        var cur = $("#ExampleList > div").length;
        $("#ExampleList div:first").css("display","none");
        list.forEach(function (value) {
          var example = $("#ExampleList div:first").clone().css("display", "block");
          var labelHtml = $(example).children("div:eq(0)").html();
          var contentHtml = $(example).children("div:eq(1)").html();
          var sourceHtml = $(example).children("div:eq(2)").html();

          $(example).children("div:eq(0)").html(labelHtml.replace("{{ label }}", cur + ". "));
          $(example).children("div:eq(1)").html(contentHtml.replace("{{ content }}", value.content));
          $(example).children("div:eq(2)").html(sourceHtml.replace("{{ source }}", value.source));

          $("#ExampleList").append(example);
          cur++;
        });
      }

      function initialLoading() {
        $("#SearchBox").val($("#SearchBox").val().replace("{{ q }}", getData("q")));

        var dict = getData("dict");
        $("#ResultItem").html($("#ResultItem").html().replace("{{ word }}", dict.word));
        $("#EnglishPronounce").html($("#EnglishPronounce").html().replace("{{ english }}", dict.english));
        $("#AmericanPronounce").html($("#AmericanPronounce").html().replace("{{ american }}", dict.american));
        $("#WordExplanation p:first").css("display","none");
        dict.explanation.forEach(function (value) {
          var explanation = $("#WordExplanation p:first").clone().css("display", "block");
          explanation.html(explanation.html().replace("{{ explanation }}", value));
          $("#WordExplanation").append(explanation);
        });

        var r = getData("r");
        $("#CountUsage").html($("#CountUsage").html().replace("{{ count }}", r.count));
        $("#SearchDomain").html($("#SearchDomain").html().replace("{{ domain }}", r.domain));
        $("#Synonymous span:first").css("display", "none");
        r.synonymous.forEach(function (value) {
          var synonymous = $("#Synonymous span:first").clone().css("display", "inline");
          synonymous.html(synonymous.html().replace("{{ synonymous }}", value));
          $("#Synonymous").append(synonymous);
        });

        r.collocation.forEach(function (value) {
          var nav = $("#CollocationTab li:eq(1)").clone();
          nav.children("a").attr("href", nav.children("a").attr("href").
                                         replace("{{ collocation_label }}", value.label));
          nav.html(nav.html().replace("{{ collocation }}", value.type));
          $("#CollocationTab").append(nav);

          var content = $("#CollocContent div:eq(1)").clone();
          content.attr("id", content.attr("id").replace("{{ collocation_label }}", value.label));
          if (value.usage) {
            var i = 0;
            value.usage.forEach(function (usage) {
              var contentItem = content.children("div").children("div:eq(" + i + ")").
                                children("p:first").clone();
              contentItem.html(contentItem.html().
                               replace("{{ usage }}", usage.content).replace("{{ count }}", usage.count));
              content.children("div").children("div:eq(" + i + ")").append(contentItem);
              i = (i + 1) % 3;
            });
          }
          content.children("div").children("div:eq(0)").children("p:first").css("display", "none");
          content.children("div").children("div:eq(1)").children("p:first").css("display", "none");
          content.children("div").children("div:eq(2)").children("p:first").css("display", "none");
          $("#CollocContent").append(content);
        });
        $("#CollocationTab li:eq(1)").css("display", "none");
        $("#CollocContent div:eq(1)").css("display", "none");

        var suggestion = getData("suggestion");
        suggestion.related.forEach(function (value) {
          var related = $("#RelatedWords p:first").clone();
          related.html(related.html().replace("{{ related }}", value));
          $("#RelatedWords").append(related);
        });
        suggestion.hot.forEach(function (value) {
          var hot = $("#HotWords p:first").clone();
          hot.html(hot.html().replace("{{ hot }}", value));
          $("#HotWords").append(hot);
        });
        $("#RelatedWords p:first").css("display", "none");
        $("#HotWords p:first").css("display", "none");

        var example = getData("example");
        appendExampleList( example.list );
        if (example.ended) loaded = 1;
      }
      /*----------------- Testing code ------------------*/

      initialLoading();

      $( window ).scroll( function () {
        if ($(document).height() <= $(window).scrollTop() + $(window).height()) {
          if (loading == 1 || loaded == 1 || loadCount > 4) return;

          loading = 1;
          $("#Loading").show();
          var obj = getData("example");
          setTimeout(function() {
            $("#Loading").hide();
            loading = 0;
            if (typeof(obj) == "undefined") {
              // failed to load obj
            } else if (obj.ended == 1) {
              loaded = 1;
            } else {
              loadCount++;
              appendExampleList( obj.list );
            }
          }, 2000);
        }
      });

    } );
    </script>
  </head>

  <body>

    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand esoda-brand" href="index.html">Esoda</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <div class="row">
            <div class="col-sm-4">
              <form class="navbar-form navbar-left full-width" role="search" action="result.html">
                <div id="ResultSearchBar" class="input-group full-width">
                  <input type="text" id="SearchBox" class="form-control" name="q" value="{{ q }}">
                  <span class="input-group-btn">
                    <button class="btn btn-default" type="submit">
                      <span class="glyphicon glyphicon-search"></span>
                    </button>
                  </span>
                </div>
              </form>
            </div>
            <ul class="nav nav-pills navbar-right nav-pills-reg" role="tablist">
              <li role="presentation"><a href="#">登陆</a></li>
              <li role="presentation" class="active"><a href="#">注册</a></li>
            </ul>
          </div>
        </div><!--/.navbar-collapse -->
      </div>
    </nav>

    <div class="result-page">
      <div class="container">
        <div class="row">
          <div class="col-sm-8 result-main">
            <div>
              <div class="result-callout">
                <div class="row">
                  <div class="col-sm-6 col-md-6" style="border-right:dashed 1px #ddd">
                    <p id="ResultItem">{{ word }}</p>
                    <div class="row">
                      <div class="col-sm-6 col-md-4">
                        <span class="glyphicon glyphicon-volume-up"></span>
                        <span>英</span>
                        <span id="EnglishPronounce">{{ english }}</span>
                      </div>
                      <div class="col-sm-6 col-md-4">
                        <span class="glyphicon glyphicon-volume-up"></span>
                        <span>美</span>
                        <span id="AmericanPronounce">{{ american }}</span>
                      </div>
                    </div>
                  </div>
                  <div class="col-sm-6 col-md-6">
                    <div id="WordExplanation">
                      <p>{{ explanation }}</p>
                    </div>
                  </div>
                </div>
              </div>

              <div class="result-warning">
                <span>找到相关用法&nbsp;<span id="CountUsage">{{ count }}</span>&nbsp;个：</span>
                <span style="float:right">现在搜索领域为：<span id="SearchDomain">{{ domain }}</span>&nbsp;&nbsp;不是您的领域？<a href="#">自定义搜索领域</a></span>
              </div>

              <div class="result-table-cell row">
                <div class="result-subtitle col-sm-1">同义</div>
                <div id="Synonymous" class="col-sm-11">
                  <span><a href=""> {{ synonymous }} </a></span>
                </div>
              </div>

              <div class="result-table-cell row">
                <div class="result-subtitle col-sm-1">搭配</div>
                <div class="col-sm-11" id="Collocation">
                  <ul class="nav nav-tabs" id="CollocationTab" role="tablist">
                    <li role="presentation" class="active">
                      <a href="#CollocAll" role="tab" data-toggle="tab">全部</a>
                    </li>
                    <li role="presentation">
                      <a href="#{{ collocation_label }}" role="tab" data-toggle="tab">{{ collocation }}</a>
                    </li>
                  </ul>
                  <div id="CollocContent" class="tab-content">
                    <div role="tabpanel" class="tab-pane fade" id="CollocAll"></div>
                    <div role="tabpanel" class="tab-pane fade" id="{{ collocation_label }}">
                      <div class="row colloc-result">
                        <div class="col-sm-4">
                          <p><a href="">{{ usage }}({{ count }})</a></p>
                        </div>
                        <div class="col-sm-4">
                          <p><a href="">{{ usage }}({{ count }})</a></p>
                        </div>
                        <div class="col-sm-4">
                          <p><a href="">{{ usage }}({{ count }})</a></p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
              </div>

              <!-- TODO: Modify the list to collapse panel. To achieve multiselection, do not use "data-parent" -->
              <div id="ExampleList" class="panel-group">
                <div class="panel panel-default result-table-cell">
                  <div class="panel-heading">
                    {{ label }}
                  </div>
                  <div class="panel-body example-list-content">
                    {{ content }}
                  </div>
                  <div class="panel-footer example-list-source">
                    {{ source }}
                  </div>
                </div>
              </div>

              <div id="Loading" class="result-table-cell center-align">
                <p><i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i><span>正在加载</span></p>
              </div>

            </div>
          </div>

          <!--TODO: make these fixed and add a "return to top" button-->
          <div class="col-sm-3 result-sidebar">
            <div class="container" id="RelatedWords">
              <h4>大家都在搜</h4>
              <p><a href="">{{ related }}</a></p>
            </div>
            <div class="container" id="HotWords">
              <h4>领域内热词</h4>
              <p><a href="">{{ hot }}</a></p>
            </div>
          </div>
        </div>
      </div>
    </div>


    <footer class="footer">
      <div class="container container-footer">
        <div class="row">
          <div class="col-sm-3 col-md-2 col-md-offset-2">
            <p><a href="#" class="footer-link">FOOTER链接</a></p>
          </div>
          <div class="col-sm-3 col-md-2">
            <p><a href="#" class="footer-link">FOOTER链接</a></p>
          </div>
          <div class="col-sm-3 col-md-2">
            <p><a href="#" class="footer-link">FOOTER链接</a></p>
          </div>
          <div class="col-sm-3 col-md-2">
            <p><a href="#" class="footer-link">FOOTER链接</a></p>
          </div>
        </div>
        <p class="copyright col-sm-4 col-sm-offset-4">Esoda &copy; 2012-2017.</p>
      </div>
    </footer>


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="js/ie10-viewport-bug-workaround.js"></script>
  </body>
</html>
